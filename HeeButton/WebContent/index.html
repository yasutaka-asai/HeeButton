<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript"
	src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
</head>
<body>
	<h1>みんなで押せるへぇボタン</h1>
	<dl>
		<dd></dd>
	</dl>

	<script type="text/javascript">

		volumeFlg = true;

		function playSound() {
			if(volumeFlg){
				var audio = new Audio('Hee.mp3');
				audio.play();
			}
		};

		function volume() {
			if(volumeFlg){
				volumeFlg = false;
			}else{
				volumeFlg = true;
			}
		}

		$(function() {
			var POLLLING_INVERVAL_TIME_IN_MILLIS = 500;//10s
			var prevCount = 0;

			(function polling() {
				getCountUp();
				window.setTimeout(polling, POLLLING_INVERVAL_TIME_IN_MILLIS);
			}());

			function getCountUp() {
				$.ajax({
					type : "GET",
					url : "HeeButton",
					content : "application/json",
					dataType : "json",
				}).done(function(data) {
					if (Number(data.count) > prevCount) {
						playSound();
						prevCount = Number(data.count);
					}
				}).fail(function(jqXHR, textStatus) {
					$("dd").text("error occured");
				});
			}
		});

		function hee() {
			$.ajax({
				type : "POST",
				url : "HeeButton",
				content : "application/json",
				dataType : "json",
			});
		}
	</script>

	<button onclick="playSound()">音を鳴らすだけ</button>
	<button onclick="volume()">ミュート切り替え</button><br>

	<a onclick="hee()"><img src="button.jpg"></a>

</body>
</html>